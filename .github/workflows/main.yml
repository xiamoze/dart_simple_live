è·³è‡³å†…å®¹
å¯¼èˆªèœå•
é€é¥
dart_simple_live

è¾“å…¥/æœç´¢
ä»£ç 
æ‹‰å–è¯·æ±‚
5
è¡ŒåŠ¨
å®‰å…¨
æ´å¯Ÿ
åº”ç”¨ç¨‹åºæ„å»ºæ“ä½œå¼€å‘
åˆå¹¶åˆ†æ”¯ 'pr/Otiosum-coder/761' #92
å·¥ä½œ
è¿è¡Œè¯¦ç»†ä¿¡æ¯
æœ¬æ¬¡è¿è¡Œçš„å·¥ä½œæµæ–‡ä»¶
.github/workflows/publish_app_dev.yaml åœ¨ fd821db
åç§°ï¼šapp-build-action-dev

åœ¨ï¼š
  å·¥ä½œæµç¨‹è°ƒåº¦ï¼š
  æ¨ï¼š
    åˆ†æ”¯æœºæ„ï¼š
      - â€˜å¼€å‘â€™

å·¥ä½œï¼š
  #é¢„ç•™Androidã€iOSã€Mac
  æ„å»º-mac-ios-androidï¼š
    è¿è¡Œäºï¼šmacos-latest

    æƒé™ï¼š
      å†…å®¹ï¼šå†™

    æ­¥éª¤ï¼š
      #ç­¾å‡ºä»£ç 
      -ç”¨é€”ï¼šactions/checkout@v4
        å’Œï¼š
          å‚è€ƒï¼šdev

      # APKç­¾åè®¾ç½®
      -åç§°ï¼šä¸‹è½½ Android å¯†é’¥åº“
        idï¼šandroid_keystore
        ç”¨é€”ï¼štimheuer/base64-to-file@v1.2
        å’Œï¼š
          æ–‡ä»¶åï¼škeystore.jks
          ç¼–ç å­—ç¬¦ä¸²ï¼š${{ secrets.KEYSTORE_BASE64 }}
      - nameï¼šåˆ›å»º key.properties
        è¿è¡Œï¼š|
          echoâ€œstoreFile = $ {{steps.android_keystore.outputs.filePath}}â€> simple_live_app/android/key.properties
          echo "storePassword=${{ secrets.STORE_PASSWORD }}" >> simple_live_app/android/key.properties
          echo "keyPassword=${{ secrets.KEY_PASSWORD }}" >> simple_live_app/android/key.properties
          echo "keyAlias=${{ secrets.KEY_ALIAS }}" >> simple_live_app/android/key.properties
      #è®¾ç½®JAVAç¯å¢ƒ
      -ç”¨é€”ï¼šactions/setup-java@v4
        å’Œï¼š
          åˆ†å¸ƒï¼š' zulu '
          Java ç‰ˆæœ¬ï¼šâ€œ 17 â€
          ç¼“å­˜ï¼šâ€œ gradle â€

      #è®¾ç½®Flutter
      -åç§°ï¼šFlutter åŠ¨ä½œ
        ç”¨é€”ï¼šsubosito/flutter-action@v2
        å’Œï¼š
          flutter ç‰ˆæœ¬ï¼š' 3.22.x '
          ç¼“å­˜ï¼štrue 

      #æ‰“å¼€MACæ¡Œé¢æ”¯æŒ
      - nameï¼šå¯ç”¨ Flutter æ¡Œé¢
        è¿è¡Œï¼šflutter config --enable-macos-desktop

      #æ›´æ–°Flutterçš„åŒ…
      -åç§°ï¼šæ¢å¤åŒ…
        è¿è¡Œï¼š|
          cd simple_live_app
          Flutter pub è·å–
      #å®‰è£…appdmg npm install -g appdmg
      -åç§°ï¼šå®‰è£… appdmg
        è¿è¡Œï¼šnpm install -g appdmg

      #è®¾ç½®flutter_distributorç¯å¢ƒ
      -åç§°ï¼šå®‰è£… flutter_distributor
        è¿è¡Œï¼šdart pub global activate flutter_distributor

      #å‹ç¼©APK
      -åç§°ï¼šæ„å»ºAPK
        è¿è¡Œï¼š|
          cd simple_live_app
          Flutter æ„å»º apk --release --split-per-abi
      #ä¸Šä¼ å·¥ä»¶
      -åç§°ï¼šå°† APK ä¸Šä¼ åˆ° Artifacts
        ç”¨é€”ï¼šactions/upload-artifact@v4
        å’Œï¼š
          åç§°ï¼šandroid
          è·¯å¾„ï¼š|
            simple_live_app/build/app/è¾“å‡º/flutter-apk/app-armeabi-v7a-release.apk
            simple_live_app/build/app/è¾“å‡º/flutter-apk/app-arm64-v8a-release.apk
            simple_live_app/build/app/è¾“å‡º/flutter-apk/app-x86_64-release.apk
      # TV APKç­¾åè®¾ç½®
      -åç§°ï¼šä¸‹è½½ Android TV å¯†é’¥åº“
        idï¼šandroid_tv_keystore
        ç”¨é€”ï¼štimheuer/base64-to-file@v1.2
        å’Œï¼š
          æ–‡ä»¶åï¼škeystore_tv.jks
          ç¼–ç å­—ç¬¦ä¸²ï¼š${{ secrets.TV_KEYSTORE_BASE64 }}
      - nameï¼šåˆ›å»º key.properties
        è¿è¡Œï¼š|
          echoâ€œstoreFile = $ {{steps.android_tv_keystore.outputs.filePath}}â€> simple_live_tv_app/android/key.properties
          echo "storePassword=${{ secrets.TV_STORE_PASSWORD }}" >> simple_live_tv_app/android/key.properties
          echo "keyPassword=${{ secrets.TV_KEY_PASSWORD }}" >> simple_live_tv_app/android/key.properties
          echo "keyAlias=${{ secrets.TV_KEY_ALIAS }}" >> simple_live_tv_app/android/key.properties
      #å‹ç¼© Android TV APK
      -åç§°ï¼šæ„å»ºç”µè§† APK
        è¿è¡Œï¼š|
          cd simple_live_tv_app
          Flutter æ„å»º apk --release --split-per-abi
      #ä¸Šä¼ TV APKè‡³Artifacts
      -åç§°ï¼šå°†ç”µè§† APK ä¸Šä¼ è‡³ Artifacts
        ç”¨é€”ï¼šactions/upload-artifact@v4
        å’Œï¼š
          åç§°ï¼šandroid_tv
          è·¯å¾„ï¼š|
            simple_live_tv_app/build/app/è¾“å‡º/flutter-apk/app-armeabi-v7a-release.apk
            simple_live_tv_app/build/app/è¾“å‡º/flutter-apk/app-arm64-v8a-release.apk
            simple_live_tv_app/build/app/è¾“å‡º/flutter-apk/app-x86_64-release.apk
      #å¤‡ä»½iOS
      -åç§°ï¼šæ„å»º IPA
        è¿è¡Œï¼š|
          cd simple_live_app
          Flutter æ„å»º iOS --release --no-codesign
      #åˆ›å»ºæœªç­¾åipa
      -åç§°ï¼šåˆ›å»º IPA
        è¿è¡Œï¼š|
          cd simple_live_app
          mkdir build/ios/iphoneos/Payload
          cp -R æ„å»º/ios/iphoneos/Runner.app æ„å»º/ios/iphoneos/Payload/Runner.app
          cd build/ios/iphoneos/
          zip -q -r ios_no_sign.ipa æœ‰æ•ˆè½½è·
          å…‰ç›˜ ../../..
      #ä¸Šä¼ IPAè‡³Artifacts
      -åç§°ï¼šå°† IPA ä¸Šä¼ åˆ° Artifacts
        ç”¨é€”ï¼šactions/upload-artifact@v4
        å’Œï¼š
          åç§°ï¼šios
          è·¯å¾„ï¼š|
            simple_live_app/build/ios/iphoneos/ios_no_sign.ipa
      #å‹ç¼©MAC
      -åç§°ï¼šæ„å»º MacOS
        è¿è¡Œï¼š|
          cd simple_live_app
          flutter_distributor è½¯ä»¶åŒ… --platform macos --targets dmg,zip --skip-clean
      
      #ä¸Šä¼ MACè‡³Artifacts
      -åç§°ï¼šå°† MacOS ä¸Šä¼ è‡³ Artifacts
        ç”¨é€”ï¼šactions/upload-artifact@v4
        å’Œï¼š
          åç§°ï¼šmac
          è·¯å¾„ï¼š|
            simple_live_app/build/dist/*/*.dmg
            simple_live_app/build/dist/*/*.zip
      #å®Œæˆ
      - run : echo "ğŸ è¿™é¡¹å·¥ä½œçš„çŠ¶æ€æ˜¯ ${{ job.status }}ã€‚"

  #å‹ç¼©Linux
  æ„å»ºLinuxï¼š
    è¿è¡Œäºï¼šubuntu-22.04
    æƒé™ï¼š
      å†…å®¹ï¼šå†™
    æ­¥éª¤ï¼š
      #ç­¾å‡ºä»£ç 
      -ç”¨é€”ï¼šactions/checkout@v4
        å’Œï¼š
          å‚è€ƒï¼šdev
      #è®¾ç½®Flutterç¯å¢ƒ
      -åç§°ï¼šè®¾ç½® Flutter
        ç”¨é€”ï¼šsubosito/flutter-action@v2
        å’Œï¼š
          flutter ç‰ˆæœ¬ï¼šâ€œ 3.22.x â€
          ç¼“å­˜ï¼štrue
      #å®‰è£…ä¾èµ–
      -åç§°ï¼šæ›´æ–° apt-get
        è¿è¡Œï¼šsudo apt-get update
      -åç§°ï¼šå®‰è£…ä¾èµ–é¡¹
        è¿è¡Œï¼šsudo apt-get install -y clang cmake ninja-build pkg-config libgtk-3-dev liblzma-dev libmpv-dev mpv
      #æ‰“å¼€Linuxæ¡Œé¢æ”¯æŒ
      - nameï¼šå¯ç”¨ Flutter æ¡Œé¢
        è¿è¡Œï¼šflutter config --enable-linux-desktop
      #æ›´æ–°Flutterçš„åŒ…
      -åç§°ï¼šæ¢å¤åŒ…
        è¿è¡Œï¼š|
          cd simple_live_app
          Flutter pub è·å–
      #è®¾ç½®flutter_distributorç¯å¢ƒ
      -åç§°ï¼šå®‰è£… flutter_distributor
        è¿è¡Œï¼šdart pub global activate flutter_distributor
      #æ„å»º Linux ZIP\DMG
      -åç§°ï¼šæ„å»º Linux
        è¿è¡Œï¼š|
          cd simple_live_app
          flutter_distributor è½¯ä»¶åŒ… --platform linux --targets deb,zip --skip-clean
      #ä¸Šä¼ LinuxåŒ…è‡³Artifacts
      -åç§°ï¼šä¸Šä¼  Linux APP åˆ° Artifacts
        ç”¨é€”ï¼šactions/upload-artifact@v4
        å’Œï¼š
          åç§°ï¼šlinux
          è·¯å¾„ï¼š|
            simple_live_app/build/dist/*/*.deb
            simple_live_app/build/dist/*/*.zip
        #å®Œæˆ
      - run : echo "ğŸ Linux ä½œä¸šçš„çŠ¶æ€ä¸º ${{ job.status }}ã€‚"

  #å¤‡ä»½Windows
  æ„å»ºçª—å£ï¼š
    è¿è¡Œäºï¼šwindows-latest
    æƒé™ï¼š
      å†…å®¹ï¼šå†™
    æ­¥éª¤ï¼š
      #ç­¾å‡ºä»£ç 
      -ç”¨é€”ï¼šactions/checkout@v4
        å’Œï¼š
          å‚è€ƒï¼šdev
      #è®¾ç½®Flutterç¯å¢ƒ
      -åç§°ï¼šè®¾ç½® Flutter
        ç”¨é€”ï¼šsubosito/flutter-action@v2
        å’Œï¼š
          flutter ç‰ˆæœ¬ï¼šâ€œ 3.22.x â€
          ç¼“å­˜ï¼štrue
      - nameï¼šå¯ç”¨ Flutter æ¡Œé¢
        è¿è¡Œï¼šflutter config --enable-windows-desktop
      -åç§°ï¼šæ¢å¤åŒ…
        è¿è¡Œï¼š|
          cd simple_live_app
          Flutter pub è·å–
      #è®¾ç½®flutter_distributorç¯å¢ƒ
      -åç§°ï¼šå®‰è£… flutter_distributor
        è¿è¡Œï¼šdart pub global activate flutter_distributor
      #æ„å»º Windows ZIP\MSIX
      -åç§°ï¼šæ„å»º Windows
        è¿è¡Œï¼š|
          cd simple_live_app
          flutter_distributor åŒ… --platform windows --targets msix,zip --skip-clean
      #ä¸Šä¼ Windowsè‡³Artifacts
      -åç§°ï¼šå°† Windows APP ä¸Šä¼ åˆ° Artifacts
        ç”¨é€”ï¼šactions/upload-artifact@v4
        å’Œï¼š
          åç§°ï¼šwindows
          è·¯å¾„ï¼š|
            simple_live_app/build/dist/*/*.msix
            simple_live_app/build/dist/*/*.zip
        #å®Œæˆ
      - run : echo "ğŸ Windows ä½œä¸šçš„çŠ¶æ€ä¸º ${{ job.status }}ã€‚"
åˆå¹¶åˆ†æ”¯ 'pr/Otiosum-coder/761' Â· xiaoyaocz/dart_simple_live@fd821db
